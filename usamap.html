<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

 <link rel="stylesheet" href="https://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
 <script src="https://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.js"></script>
 <script src="js/leaflet.groupedlayercontrol.js" type="text/javascript"></script>
 

<style>
#map1 { height: 600px; width: 600px; margin-right: 5px; }
#map2 { height: 650px; width: 260px; margin-right: 5px;}
#map3 { height: 650px; width: 260px;}
#attribution {
  font: 12px/1.5 Lato, "Helvetica Neue", Helvetica, Arial, sans-serif;
  color: #555;}

td {
     text-align: center;
     font-weight: bold;
}



</style>

<title>PFAS Literature Map</title>

</head>

<body>
<div class="wrapper">

<header>
    <h1>PFAS</h1> 
    <h1>Literature Map</h1>
    <p>USA Locations</p>
        
</header>
<section>
<p class = "view">
<div id="map1"></div>
<script src="https://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script src="js/leaflet.groupedlayercontrol.js"></script>
<script type="text/javascript">

var map1 = L.map('map1').setView([38.5, -100.5], 3);

var osm = L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
attribution: '&amp; OpenStreetMap'}).addTo(map1);
//var watercolor = L.tileLayer('https://b.tile.stamen.com/watercolor/{z}/{x}/{y}.png').addTo(map1);

var myLayer = L.geoJson().addTo(map1);
var xmlhttp = new XMLHttpRequest();
var url = 'https://api.zotero.org/users/5583871/collections/3LEZ3E8D/items?v=3';

xmlhttp.onreadystatechange = function() {
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
        var myArr = JSON.parse(xmlhttp.responseText);
        myFunction(myArr);
    }
}
xmlhttp.open("GET", url, true);
xmlhttp.send();


function myFunction(arr) {
    var parsetext;
    var i;
    for(i = 0; i < arr.length; i++) { 
        var pophttp = new XMLHttpRequest();
        var popurl = 'https://api.zotero.org/users/5583871/items/'+ arr[i].data.key +'?format=bib&v=3';
		var extratext = arr[i].data.extra;
		var extrageom = extratext.substr(extratext.search("<geojson>")+9, (extratext.search("</\\geojson>")-extratext.search("<geojson>"))-10) + '}';
                
        parsetext = '[{"type": "Feature", "properties":{"key": "' + arr[i].data.key + '", "popupContent": "<iframe src= '+ popurl + '></> + "}, "geometry":' + extrageom + '}]';
        var geojsonFeature = JSON.parse(parsetext);
        
        L.geoJson(geojsonFeature, {
            pointToLayer: function (feature, latlng) {
            return L.circleMarker(latlng, {
            radius: 4,
            fillOpacity: 1
            }).bindPopup(feature.properties.popupContent);
                }
            }).addTo(myLayer);
        }};

</script>
<!--</div> -->
</p>
</section>
<section>
<h3>About This Map</h3>
<p>Words</p>

</section>
<section>
<h3>Citation:</h3>
<p id="citation"> Tobias, M.M. & A.I. Mandel.  2015. Beach Plant Literature Map.  https://micheletobias.github.io/maps/LiteratureMap.html </p>
</section>





</body>



</body>
